<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <title>IPTV Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
<div class="app">
    <header class="header">
        <h1>DRM IPTV Panel</h1>
        <p>SadÉ™ pulsuz IPTV paneli â€“ HLS / M3U8 dÉ™stÉ™yi</p>
    </header>

    <main class="main">
        <aside class="sidebar">
            <h2>Kanallar</h2>
            <ul id="channelList"></ul>
        </aside>

        <section class="player-area">
            <div class="player-wrapper">
                <video id="videoPlayer" controls autoplay playsinline></video>
            </div>
            <div class="now-playing">
                <h2 id="currentChannelName">Kanal seÃ§ilmÉ™yib</h2>
                <p id="currentChannelInfo">Soldan kanal seÃ§.</p>
            </div>
        </section>
    </main>

    <footer class="footer">
        <span>HazÄ±rlayan: ReÅŸad Ã¼Ã§Ã¼n xÃ¼susi IPTV panel ğŸ˜</span>
    </footer>
</div>

<script>
    let channels = [];
    let currentHls = null;

    function playChannel(channel) {
        const video = document.getElementById("videoPlayer");
        const nameEl = document.getElementById("currentChannelName");
        const infoEl = document.getElementById("currentChannelInfo");

        nameEl.textContent = channel.name;
        infoEl.textContent = channel.info || channel.url;

        // KÃ¶hnÉ™ HLS obyekti varsa, silÉ™k
        if (currentHls) {
            currentHls.destroy();
            currentHls = null;
        }

        // HLS dÉ™stÉ™klÉ™nirsÉ™
        if (Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource(channel.url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, function () {
                video.play().catch(() => {});
            });
            currentHls = hls;
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            // Safari vÉ™ s.
            video.src = channel.url;
            video.play().catch(() => {});
        } else {
            alert("Bu brauzer HLS (m3u8) dÉ™stÉ™klÉ™mir. BaÅŸqa brauzer yoxla.");
        }
    }

    function renderChannelList() {
        const listEl = document.getElementById("channelList");
        listEl.innerHTML = "";

        channels.forEach((ch, index) => {
            const li = document.createElement("li");
            li.textContent = ch.name;
            li.classList.add("channel-item");
            li.addEventListener("click", () => {
                // Aktiv kanal stilini dÉ™yiÅŸ
                document
                    .querySelectorAll(".channel-item")
                    .forEach(el => el.classList.remove("active"));
                li.classList.add("active");

                playChannel(ch);
            });

            // Birinci kanalÄ± auto aktiv elÉ™
            if (index === 0) {
                li.classList.add("active");
            }

            listEl.appendChild(li);
        });

        // Ä°lk kanalÄ± avtomatik aÃ§
        if (channels.length > 0) {
            playChannel(channels[0]);
        }
    }

    // channels.json faylÄ±nÄ± oxu
    fetch("channels.json?_=" + Date.now())
        .then(res => res.json())
        .then(data => {
            channels = data;
            renderChannelList();
        })
        .catch(err => {
            console.error("channels.json yÃ¼klÉ™nmÉ™di:", err);
            alert("channels.json tapÄ±lmadÄ± vÉ™ ya sÉ™hv formatdadÄ±r.");
        });
</script>
</body>
</html>
